body {
	&.is-unscrollable {
		position: fixed;
		overflow: hidden;
		height: 100%;
		width: 100%;
	}
}

%panel {
	@include z-index(panel);
	width: 100%;
	height: 100%;
	position: fixed;
	background-color: $color-white;
	display: flex;
	flex-direction: column;
	transition: transform ease $base-transition-speed;
	transform: translateX(100%);
	left: 0;
	top: 0;
	visibility: hidden;
	opacity: 0;

	@include breakpoint($mq-md-up) {
		z-index: initial;
		position: relative;
		height: auto;
		padding: 0;
		transform: translateX(0);
		visibility: visible;
		opacity: 1;
	}

	&.is-open {
		opacity: 1;
		display: flex;
		transform: translateX(0);
		position: absolute;
		visibility: visible;
	}

	&.is-inactive {
		overflow: hidden;
	}
}

.o-filter-panel {
	&__container {
		overflow-y: auto;
		flex: 1 auto;
		display: flex;
		flex-direction: column;
		// -webkit-overflow-scrolling: touch; don't add this, it prevents respecting z index on iOS and destroys UX
		// Latest footer layer will always be hidden by first layer back button...

		@include breakpoint($mq-md-up) {
			position: relative;
			overflow: visible;
			padding: 0;
		}

		.o-checkbox-list__container {
			@include breakpoint($mq-md-up) {
				border-top: solid 1px hue(grey, 5);
				border-bottom: solid 1px hue(grey, 5);

				&::before {
					content: '';
					position: absolute;
					top: 1px;
					left: 0;
					right: 10px;
					height: 12px;
					z-index: 1;
					background: linear-gradient(rgba(white, .9), rgba(white, 0));
				}

				&::after {
					content: '';
					position: absolute;
					bottom: 1px;
					left: 0;
					right: 10px;
					height: 12px;
					z-index: 1;
					background: linear-gradient(rgba(white, 0), rgba(white, .9));
				}
			}

			.o-checkbox-list__item:first-child {
				margin-top: $base-spacing-smaller;
			}

			.o-checkbox-list__item:last-child {
				margin-bottom: $base-spacing-smaller;
			}
		}
	}

	&__container-title,
	&__filter-title {
		@include font(primary, bold);
		@include text(medium);
		padding: $base-spacing-small;

		@include breakpoint($mq-md-up) {
			display: none;
		}
	}

	&__filter-title {
		padding: $base-spacing-small 0;
		display: none;

		@include breakpoint($mq-md-up) {
			display: block;
		}

		&--first {
			padding-top: 0;
		}
	}

	&__panel {
		@extend %panel;
	}

	&__button {
		@include a-button-neutral;
		@include a-button-neutral--default;
		width: 100%;

		@include breakpoint($mq-md-up) {
			display: none;
		}
	}

	&__item {
		@include breakpoint($mq-md-up) {
			border-bottom: border($base-border-color);

			&:first-of-type {
				border-top: 0;
			}
		}

		&--active {
			border-left: 8px solid hue(teal, 30);

			@include breakpoint($mq-md-up) {
				border-left: 0;
			}
		}
	}

	&__item,
	&__link {
		@include breakpoint($mq-md-up) {
			@include font(primary);
		}
	}

	&__link--active &__link-sub {
		@include font(primary, bold);

		@include breakpoint($mq-md-up) {
			@include font(primary, bold);
			color: hue(teal, 70);
			border-left: $base-spacing-smallest solid hue(teal);
			padding-left: $base-spacing-small;
		}
	}

	&__list {
		list-style-type: none;
		padding: 0;
		margin: 0;

		&--scroll {
			overflow-y: scroll;
			height: 9.7em;
		}
	}

	&__item-link,
	&__link-sub {
		display: block;
		width: 100%;
		padding: 10px;
		border-bottom: border($base-border-color);
		cursor: pointer;
		margin: 0;
		text-align: left;

		@include breakpoint($mq-md-up) {
			@include truncate;
			border-bottom: 0;
			padding: 2px 0 2px $base-spacing;
		}

		&--have-subpanel {
			@include breakpoint($mq-md-up) {
				display: none;
			}
		}

		i {
			font-style: normal;
			text-decoration: none;
			color: hue(teal, 60);
		}
	}

	&__item-next {
		float: right;

		.a-svg-icon {
			vertical-align: text-bottom;
		}

		@include breakpoint($mq-md-up) {
			display: none;
		}
	}

	&__header {
		color: hue(grey, 70);
		background-color: $color-white;
		border-bottom: border($base-border-color);
		display: flex;
		flex: 0 0 auto;
		align-items: center;

		@include breakpoint($mq-md-up) {
			border-bottom: 0;
			margin: 0;
		}

		&-back {
			flex: 0 1 auto;
			color: hue(grey, 80);
			font-size: 0;
			padding: $base-spacing-small;
			border-right: border($base-border-color);
			width: 48px;
			text-align: center;

			@include breakpoint($mq-md-up) {
				display: none;
			}
		}

		&-title {
			@include font(primary, bold);
			@include text(medium);
			color: hue(grey, 80);
			padding: 0 $base-spacing-small;
			flex: 1 0 auto;
			line-height: 1;

			@include breakpoint($mq-md-up) {
				display: none;
			}
		}
	}

	&__active-filters {
		padding: $base-spacing;
		border-bottom: border($base-border-color);

		@include breakpoint($mq-md-up) {
			padding: $base-spacing 0;
		}
	}

	&__active-categories {
		padding: 0;
	}

	&__filters {
		margin: 0;
		padding: 0;
		font-size: 0;
	}

	&__filter {
		margin: 0 $base-spacing-small $base-spacing-small 0;
		display: inline-block;
	}

	&__footer {
		padding: $base-spacing-small;
		border-top: border($base-border-color);
		background-color: $color-white;
		display: flex;
		flex: 0 0 auto;

		&-button {
			@include a-button-neutral;
			@include a-button-neutral--bordered;
			@include text(small);
			flex: 1 0 auto;
			padding: 7px;
			margin-right: $base-spacing;

			@include breakpoint($mq-md-up) {
				margin-bottom: $base-spacing;
			}

			&:last-child {
				margin-right: 0;
			}

			&--small {
				flex: 0 1 auto;
			}

			&--bordered {
				@include a-button-neutral--bordered;
			}

			&--filled {
				@include a-button-neutral--default;
			}
		}

		@include breakpoint($mq-md-up) {
			padding: 0;
			border: 0;
			margin-top: $base-spacing-small;

			&--main {
				display: none;
			}
		}
	}

	.o-price-slider {
		padding: $base-spacing-small;

		@include breakpoint($mq-md-up) {
			padding: 0;
		}
	}

	.o-checkbox-list__container,
	.o-link-list__container {
		@include breakpoint($mq-md-up) {
			max-height: 156px;
			overflow-y: scroll;
		}
	}

	.o-link-list__item {
		@include font(primary);
		display: block;
		width: 100%;
		padding: 10px;
		border-bottom: 1px solid hue(grey, 20);
		cursor: pointer;
		margin: 0;

		@include breakpoint($mq-md-up) {
			border-bottom: 0;
			padding: 2px;
		}
	}

	.m-form-field-checkbox__label {
		padding-left: $base-spacing-small;

		@include breakpoint($mq-md-up) {
			padding-left: 0;
		}
	}

	&__item-wrapper {
		.o-filter-panel__panel {
			@include breakpoint($mq-md-up) {
				display: none;
			}
		}

		.o-filter-panel__accordion {
			display: none;

			&-icon-minus,
			&-icon-plus {
				display: none;

				@include breakpoint($mq-md-up) {
					display: inline-block;
					float: right;
				}
			}

			&-icon-minus {
				display: none;
			}

			&[type='checkbox']:checked ~ .o-filter-panel__panel {
				display: flex;
			}

			&[type='checkbox']:checked ~ .o-filter-panel__accordion-label {
				padding: $base-spacing-smaller 0;

				.o-filter-panel__accordion-icon-plus {
					display: none;
				}

				.o-filter-panel__accordion-icon-minus {
					display: inline-block;
				}
			}

			&[type='checkbox']:not(:checked) ~ .o-filter-panel__accordion-label {
				transition: border $base-transition-speed, padding $base-transition-speed;
				padding: $base-spacing-smaller 0;
				border-left: solid 0 transparent;

				&:hover {
					border-left: solid $base-spacing-smallest hue(teal, 30);
					padding-left: $base-spacing-small;
				}
			}

			&-label {
				display: none;

				@include breakpoint($mq-md-up) {
					@include font(primary, bold);
					@include text(medium);
					cursor: pointer;
					display: block;
					padding: $base-spacing-small 0;
				}
			}
		}
	}
}

.o-filter-panel--scroll {
	.o-filter-panel {
		&__list {
			@include breakpoint($mq-md-up) {
				@include force-scroll-bar; // needed coz webkit hides scrollbars if no mouse is enabled. i.e trackpad.
				max-height: 9.8em; // 5.5 items
			}
		}
	}

	// Improve... all the scrolling stuff. Hard to maintain.
	.o-link-list--scroll .o-link-list__container {
		@include breakpoint($mq-md-up) {
			@include force-scroll-bar; // needed coz webkit hides scrollbars if no mouse is enabled. i.e trackpad.
			max-height: 9.8em; // 5.5 items
		}
	}
}
