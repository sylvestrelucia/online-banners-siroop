const webpackStream = require('webpack-stream');
const webpack = require('webpack');

module.exports = (gulp, plugins, options) => {
	const config = require('../webpack.config.js')(options);
	return () => gulp.src(options.paths.js.tmp)
		.pipe(plugins.plumber())
		.pipe(webpackStream(config, webpack))
		.pipe(options.jsMinify ? plugins.rename({suffix: '.min'}) : plugins.util.noop())
		.pipe(gulp.dest(options.paths.js.dest));
};
