const path = require('path');

module.exports = (gulp, plugins, options) => () => {
	function removeFileFromCache(result) {
		delete plugins.cached.caches.stylelint[path.resolve(result.source)];
	}

	const stream = gulp.src(options.srcPath)
		.pipe(plugins.cached('stylelint'))
		.pipe(plugins.stylelint({
			failAfterError: options.sasslintConfig.failOnError,
			reporters: [
				{
					formatter: 'string',
					console: true
				},
				{
					formatter: function(resultList){
						resultList
							.filter(result => result.errored != undefined)
							.forEach(removeFileFromCache);
					}
				}
			]
		}));

	return stream;
};

